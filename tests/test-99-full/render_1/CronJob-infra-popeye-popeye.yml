---
# Source: helm-chart-of-the-death/templates/audit/popeye/popeye.yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: popeye
  namespace: infra-popeye
  annotations:
    helm.sh/resource-policy: keep
spec:
  schedule: "3 * * * *"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: popeye
          restartPolicy: Never
          containers:
            - name: popeye
              # until https://github.com/derailed/popeye/pull/278
              #image: derailed/popeye:v0.21.3
              image: ghcr.io/undistro/popeye:0.21
              imagePullPolicy: IfNotPresent
              args:
                - --push-gtwy-url=http://push-gateway-prometheus-pushgateway.infra-push-gateway:9091
                - --force-exit-zero
              resources:
                requests:
                  memory: 1000Mi
                  cpu: 50m
                limits:
                  cpu: 500m
                  memory: 1000Mi
