resources:
  requests:
    cpu: 20m
    memory: 110M
  limits:
    cpu: 500m
tolerations:
  - key: master
    operator: Exists
    effect: NoSchedule
  - key: storage
    operator: Exists
    effect: NoSchedule
config:
  clients:
    - url: http://loki-distributor.infra-loki:3100/loki/api/v1/push
  snippets:
    extraScrapeConfigs: |
      - job_name: journal
        journal:
          path: /var/log/journal
          max_age: 12h
          labels:
            job: systemd-journal
        relabel_configs:
          - source_labels: ['__journal__systemd_unit']
            target_label: unit
          - source_labels: ['__journal__hostname']
            target_label: hostname
          - source_labels: ['__journal_priority_keyword']
            target_label: level
      - job_name: syslog
        syslog:
          listen_address: 0.0.0.0:1514
          labels:
            job: "syslog"
        relabel_configs:
          - source_labels: ['__syslog_message_hostname']
            target_label: 'host'
# Cf https://github.com/grafana/helm-charts/issues/442
extraVolumes:
  - name: journal
    hostPath:
      path: /var/log/journal
  - name: machine-id
    hostPath:
      path: /etc/machine-id
extraVolumeMounts:
  - name: journal
    mountPath: /var/log/journal
    readOnly: true
  - name: machine-id
    mountPath: /etc/machine-id
    readOnly: true
updateStrategy:
  rollingUpdate:
    maxUnavailable: 50%
