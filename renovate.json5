{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "packageRules": [
    {
      // automerge patch
      "matchUpdateTypes": ["patch"],
      "matchCurrentVersion": "!/^0/",
      "automerge": true
    }
  ],
  "bumpVersions": [
    {
      "filePatterns": ["{{packageFileDir}}/Chart.{yaml,yml}"],
      "matchStrings": ["version:\\s(?<version>[^\\s]+)"],
      "bumpType": "{{#if isPatch}}patch{{else}}minor{{/if}}"
    }
  ],
  "customManagers": [
    {
      "customType": "jsonata",
      "fileFormat": "yaml",
      "managerFilePatterns": ["/(^|/)charts/.*/values.yaml$/"],
      "matchStrings": [
        "$map(components[].*[].*, function($c,$r) {{ \"depName\": $c.chartName, \"currentValue\": $c.chartVersion, \"registryUrl\": repositories[name=$c.chartRepository].url }})"
      ],
      "datasourceTemplate": "helm"
    }
  ]
}
